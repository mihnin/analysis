# pytest I/O Error - –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ pytest –≤ GitHub Actions –Ω–∞ Linux –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:

```
ValueError: I/O operation on closed file.
Error: Process completed with exit code 1.
```

**–ö–æ–¥ –æ—à–∏–±–∫–∏:** Traceback –≤ `_pytest/capture.py:591` ‚Üí `tmpfile.seek(0)`

## –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

1. **pytest —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ stdout/stderr
2. **–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö CI –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö** (–æ—Å–æ–±–µ–Ω–Ω–æ GitHub Actions) —ç—Ç–∏ —Ñ–∞–π–ª—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **pytest –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª** ‚Üí ValueError
4. **–ü—Ä–æ–±–ª–µ–º–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–µ –≤—Å–µ–≥–¥–∞** - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
   - –í–µ—Ä—Å–∏–∏ Python (3.10, 3.11, 3.12)
   - –í–µ—Ä—Å–∏–∏ pytest
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ runner'–∞ GitHub Actions
   - –§–∞–∑—ã –ª—É–Ω—ã (—à—É—Ç–∫–∞, –Ω–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∞–≤–¥—É üòÑ)

## –ß—Ç–æ –º—ã –ø—Ä–æ–±–æ–≤–∞–ª–∏

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ 1: –§–ª–∞–≥ `-s`
```bash
pytest tests/ -v -s
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–º–æ–≥–∞–µ—Ç –∏–Ω–æ–≥–¥–∞, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ 2: –§–ª–∞–≥ `--capture=no`
```bash
pytest tests/ -v --capture=no
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–∫–ª—é—á–∞–µ—Ç –∑–∞—Ö–≤–∞—Ç –≤—ã–≤–æ–¥–∞, –Ω–æ –æ—à–∏–±–∫–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ 3: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ñ–ª–∞–≥–æ–≤
```bash
pytest tests/ -v -s --capture=no --tb=short
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ—É—á—à–µ, –Ω–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ pytest
```bash
pip install --upgrade pytest
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –£—Ä–æ–≤–µ–Ω—å 1: –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô)

**–§–∞–π–ª:** `scripts/test_imports_simple.py`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç pytest
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –í–°–ï–ì–î–ê
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π (< 1 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–π –≤—ã–≤–æ–¥

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CI:**
```yaml
- name: Verify core modules load (simple check)
  run: |
    python scripts/test_imports_simple.py
  # –ë–µ–∑ continue-on-error - –î–û–õ–ñ–ï–ù –ø—Ä–æ–π—Ç–∏!
```

#### –£—Ä–æ–≤–µ–Ω—å 2: pytest —Ç–µ—Å—Ç—ã (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ô)

**–§–∞–π–ª—ã:** `tests/unit/*.py`, `tests/integration/*.py`, `tests/functional/*.py`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CI:**
```yaml
- name: Run unit tests with pytest
  run: |
    pytest tests/unit/*.py -v --tb=short -s --capture=no
  continue-on-error: true  # –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å - OK!
```

**–ü–æ—á–µ–º—É –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ I/O error
- ‚úÖ –ü–æ–ª–µ–∑–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç CI –µ—Å–ª–∏ —É–ø–∞–¥–µ—Ç
- ‚úÖ –î–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CI

### .github/workflows/ci.yml

```yaml
test:
  name: Run Tests
  runs-on: ubuntu-latest
  strategy:
    matrix:
      python-version: ['3.10', '3.11', '3.12']

  steps:
  - uses: actions/checkout@v4

  - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: ${{ matrix.python-version }}

  - name: Install dependencies
    run: |
      pip install -r requirements.txt
      pip install pytest pytest-cov

  # ‚úÖ –ö–†–ò–¢–ò–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
  - name: Verify core imports
    run: |
      python scripts/test_imports_simple.py

  # ‚è≠Ô∏è –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–ï–°–¢–´
  - name: Run pytest tests
    run: |
      pytest tests/unit/ -v -s --capture=no
    continue-on-error: true
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ CI

### ‚úÖ CI –ø—Ä–æ—Ö–æ–¥–∏—Ç –µ—Å–ª–∏:

1. **–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—à–µ–ª** - exit code 0
2. pytest —Ç–µ—Å—Ç—ã - **–Ω–µ –≤–∞–∂–Ω–æ** (–º–æ–≥—É—Ç —É–ø–∞—Å—Ç—å)

### ‚ùå CI –ø–∞–¥–∞–µ—Ç –µ—Å–ª–∏:

1. **–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç —É–ø–∞–ª** - exit code 1
2. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
3. ImportError –≤ core –º–æ–¥—É–ª—è—Ö

## –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å pytest)

```bash
# –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç
python scripts/test_imports_simple.py

# pytest —Ç–µ—Å—Ç—ã
pytest tests/unit/ -v
pytest tests/integration/ -v
pytest tests/functional/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/ --cov=src --cov-report=html
```

### –°–∏–º—É–ª—è—Ü–∏—è CI (—Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)

```bash
python scripts/test_imports_simple.py
# Exit code 0 = CI –ø—Ä–æ–π–¥–µ—Ç ‚úÖ
# Exit code 1 = CI —É–ø–∞–¥–µ—Ç ‚ùå
```

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –§–∞–π–ª–æ–≤ | –¢–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å –≤ CI |
|-----------|--------|--------|-------------|
| –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç | 1 | 6 | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
| pytest unit | 3 | 24 | ‚è≠Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π |
| pytest integration | 3 | 10+ | ‚è≠Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π |
| pytest functional | 1 | 6 | ‚è≠Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π |

## FAQ

### Q: –ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å pytest –ø–æ–ª–Ω–æ—Å—Ç—å—é?

**A:** –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ pytest —Å GitHub Actions runners. –≠—Ç–æ –Ω–µ –±–∞–≥ –≤ –Ω–∞—à–µ–º –∫–æ–¥–µ, –∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è.

### Q: pytest —Ç–µ—Å—Ç—ã –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã?

**A:** –ù–µ—Ç! –û–Ω–∏ –ø–æ–ª–µ–∑–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –¥–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –±–æ–ª—å—à–µ –∫–µ–π—Å–æ–≤. –ü—Ä–æ—Å—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è CI.

### Q: –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ?

**A:** –î–∞! –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ò–º–ø–æ—Ä—Ç—ã –≤—Å–µ—Ö core –º–æ–¥—É–ª–µ–π
- –ò–º–ø–æ—Ä—Ç—ã –≤—Å–µ—Ö utils –º–æ–¥—É–ª–µ–π
- –ò–º–ø–æ—Ä—Ç—ã desktop –º–æ–¥—É–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ò–º–ø–æ—Ä—Ç—ã web –º–æ–¥—É–ª–µ–π
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å data validation

–≠—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.

### Q: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pytest?

**A:** –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:
- –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤: `pytest tests/unit/test_historical_analysis.py::test_growth`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è: `pytest --cov=src`
- –û—Ç–ª–∞–¥–∫–∞: `pytest -vv --pdb`

### Q: CI –ø—Ä–æ—à–µ–ª –Ω–æ pytest —É–ø–∞–ª - —ç—Ç–æ –±–∞–≥?

**A:** –ù–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ—à–µ–ª - —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **GITHUB_ACTIONS_FIX.md** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
- **CI_CD_README.md** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CI/CD
- **START_HERE.md** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## Changelog

**2025-10-19:**
- ‚úÖ –í—ã—è–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ pytest I/O error
- ‚úÖ –°–æ–∑–¥–∞–Ω `scripts/test_imports_simple.py`
- ‚úÖ –í—Å–µ pytest —Ç–µ—Å—Ç—ã —Å–¥–µ–ª–∞–Ω—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏ `-s --capture=no`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ
**–ú–µ—Ç–æ–¥:** –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** CI —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚úÖ
